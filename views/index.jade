extends layout

block content  

  div(data-role='page', data-theme='b', data-content-theme='b')

    div(data-role='header')
      a(href="#myPopup" data-rel="popup" data-icon='gear') #{username}
      h1= title
      a(href='/logout', class='ui-btn-right') Log out
    div(data-role='main', class="ui-content")      
      h3 Your Tracks 
      
      div(data-role="popup" id="myPopup" class="ui-content" data-rel="/")
        p Not implemented yet.

      
      div(class='ui-grid-b my-breakpoint') 
        div(class="ui-block-a")
          if tracklist.length !== 0
            ul(id='tracks', data-role="listview")                     
              each val, index in tracklist
                li(class="ui-collapsible-inset")                  
                  a(class="btn", href='/?track=#{index}', data-ajax='false') #{val}    
          else
            ul(id='notracks', data-role="listview")
              li No tracks
            
        div(class='ui-block-b')
          div(id='map')
            p(id='mapinfo') No track to display

      br
      
      div(class='ui-grid-b my-breakpoint')
        fieldset(class='ui-block-a', style='width:100%')
          legend Track information
          table(class='ui-block-a', style='width:100%')
            tr
              th Duration
              th Distance
              th Average speed
            tr
              td #{duration ? duration : '00:00:00' }
              td #{dist ? dist : '0'} km
              td #{speed ? speed : '0' } km/h
              
          if desc            
            div(class='ui-block-a', style='width:100%')
              h4 Description
              p(id="description") #{desc}
         
      br 
      
      div(class='ui-grid-b my-breakpoint-2')
        fieldset(class='ui-block-a', style='width:100%')
          legend Add new track
          form(action='/addtrack', method='post', enctype='multipart/form-data', data-ajax='false') 
            div(class='ui-block-a', style='width:100%') 
              input(type='text', name='description', placeholder='Track description...')
            div(class='ui-block-a') 
              input(type='file', name='gpxfile', required)
            div(class='ui-block-b')
              input(type='submit', value='Upload')          
      
    script(src='http://maps.google.com/maps/api/js?sensor=false')
    script.
      var points = !{trackpoints}
    script(src='/javascripts/map.js')    